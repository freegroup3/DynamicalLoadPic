<?xml version="1.0" encoding="utf-8"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009" 
			   xmlns:s="library://ns.adobe.com/flex/spark" 
			   xmlns:mx="library://ns.adobe.com/flex/mx" 
			   minWidth="955" minHeight="600"
			   applicationComplete="init()">
	<s:layout>
		<s:HorizontalLayout/>
	</s:layout>
	<fx:Script>
		<![CDATA[
			import mx.collections.XMLListCollection;
			import mx.managers.PopUpManager;
			import spark.components.Grid;
			import spark.components.TitleWindow;
			import spark.events.GridSelectionEvent;
			import spark.events.IndexChangeEvent;
			
			public var snd:Sound;
			public var sndchannel:SoundChannel;
			
			[Bindable]
			public var allTypeSourceXML:XML = new XML();
			
			private var txtLoader:URLLoader;
			private var mp3Selected:String;
			
			[Bindable]
			private var jpgSelected:String;
			
			[Bindable]
			private var pngSelected:String;
			
			[Bindable]
			private var swfSelected:String;
			
			static private const LOADER_COMPLETE:String = "complete";
			
			private function init():void
			{
				var myLoader:URLLoader = new URLLoader(new URLRequest("assets/user-data.xml"));
				myLoader.addEventListener(LOADER_COMPLETE, xmlLoaded);
				myLoader.addEventListener(IOErrorEvent.IO_ERROR, xmlErrorHandler);
				myLoader.addEventListener(SecurityErrorEvent.SECURITY_ERROR, xmlErrorHandler);
				
				txtLoader = new URLLoader();
				txtLoader.addEventListener(Event.COMPLETE, onLoaded);
				txtLoader.addEventListener(IOErrorEvent.IO_ERROR, txtErrorHandler);
				txtLoader.addEventListener(SecurityErrorEvent.SECURITY_ERROR, txtErrorHandler);
			}
			
			public function xmlLoaded(event:Event):void
			{
				showTxt.text = "XML載入成功";
				allTypeSourceXML = XML(event.currentTarget.data);
			}
			
			private function TXTselectionChangeHandler(event:Event):void
			{
				txtLoader.load(new URLRequest(event.currentTarget.selectedItem));
			}
			
			private function JPGselectionChangeHandler(event:Event):void
			{
				jpgSelected = event.currentTarget.selectedItem;
			}
			
			private function PNGselectionChangeHandler(event:Event):void
			{
				pngSelected = event.currentTarget.selectedItem;
			}
			
			private function MP3selectionChangeHandler(event:Event):void
			{
				mp3Selected = event.currentTarget.selectedItem;
			}
			
			private function SWFselectionChangeHandler(event:Event):void
			{
				swfSelected = event.currentTarget.selectedItem;
			}
			
			private function playMp3InAsset(e:MouseEvent):void
			{
				snd = new Sound(new URLRequest(mp3Selected));
				sndchannel = snd.play();
			}
			
			private function stopMp3InAsset(e:MouseEvent):void
			{
				sndchannel.stop();
			}
			
			private function onLoaded(e:Event):void
			{
				showTxt.text = e.target.data;
			}
			
			private function xmlErrorHandler(event:Event):void
			{
				showTxt.text = "XML載入錯誤";
				throw new IllegalOperationError("cannot load the specified file");
			}
			
			private function txtErrorHandler(event:Event):void
			{
				showTxt.text = "txt載入錯誤";
				throw new IllegalOperationError("cannot load the specified file");
			}
			
			protected function showJpg_ioErrorHandler(event:IOErrorEvent):void
			{
				showTxt.text = "jpg載入錯誤";
				throw new IllegalOperationError("cannot load the specified file");
			}
			
			protected function showPng_ioErrorHandler(event:IOErrorEvent):void
			{
				showTxt.text = "png載入錯誤";
				throw new IllegalOperationError("cannot load the specified file");
			}
			
			protected function swfloader1_ioErrorHandler(event:IOErrorEvent):void
			{
				showTxt.text = "swf載入錯誤";
				throw new IllegalOperationError("cannot load the specified file");
			}
			
		]]>
	</fx:Script>
	<s:HGroup>
		<s:VGroup height="490" paddingLeft="30">
			<s:List id="showTXT" change="TXTselectionChangeHandler(event)">
				<s:dataProvider>
					<s:XMLListCollection source="{allTypeSourceXML.txt.children()}"/>
				</s:dataProvider>
			</s:List>
			<s:List id="showjpg" change="JPGselectionChangeHandler(event)">
				<s:dataProvider>
					<s:XMLListCollection source="{allTypeSourceXML.jpg.children()}"/>
				</s:dataProvider>
			</s:List>
			<s:List id="showpng" change="PNGselectionChangeHandler(event)">
				<s:dataProvider>
					<s:XMLListCollection source="{allTypeSourceXML.png.children()}"/>
				</s:dataProvider>
			</s:List>
			<s:List id="showmp3" change="MP3selectionChangeHandler(event)">
				<s:dataProvider>
					<s:XMLListCollection source="{allTypeSourceXML.mp3.children()}"/>
				</s:dataProvider>
			</s:List>
			<s:List id="showSWF" change="SWFselectionChangeHandler(event)">
				<s:dataProvider>
					<s:XMLListCollection source="{allTypeSourceXML.swf.children()}"/>
				</s:dataProvider>
			</s:List>
		</s:VGroup>
		
		<s:VGroup width="360">
			<s:Label fontSize="24" id="showTxt"/>
			<mx:Image id="showJpg" source="{jpgSelected}" ioError="showJpg_ioErrorHandler(event)"/>
			<mx:Image id="showPng" source="{pngSelected}" ioError="showPng_ioErrorHandler(event)"/>
		</s:VGroup>
		
		<s:VGroup width="360">
			<s:Button label="播放" id="playSound" click="playMp3InAsset(event)"/>
			<s:Button label="暫停" id="stopSound" click="stopMp3InAsset(event)"/>
			<s:SWFLoader source="{swfSelected}" ioError="swfloader1_ioErrorHandler(event)"/>
		</s:VGroup>
	</s:HGroup>
</s:Application>